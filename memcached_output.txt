root@node2:~/Ansible-scripts/memcached# ansible-playbook memcached.yml -i hosts -vv

PLAY [memcached] **************************************************************

GATHERING FACTS ***************************************************************
<192.168.56.104> REMOTE_MODULE setup
<192.168.56.105> REMOTE_MODULE setup
<192.168.56.103> REMOTE_MODULE setup
ok: [192.168.56.103]
ok: [192.168.56.104]
ok: [192.168.56.105]

TASK: [Memcached_Install_packages] ********************************************
<192.168.56.104> REMOTE_MODULE apt name=php5-memcache,memcached,apache2,php5,libapache2-mod-php5,php5-mcrypt state=latest update_cache=yes
<192.168.56.105> REMOTE_MODULE apt name=php5-memcache,memcached,apache2,php5,libapache2-mod-php5,php5-mcrypt state=latest update_cache=yes
<192.168.56.103> REMOTE_MODULE apt name=php5-memcache,memcached,apache2,php5,libapache2-mod-php5,php5-mcrypt state=latest update_cache=yes
ok: [192.168.56.104] => (item=php5-memcache,memcached,apache2,php5,libapache2-mod-php5,php5-mcrypt) => {"changed": false, "item": "php5-memcache,memcached,apache2,php5,libapache2-mod-php5,php5-mcrypt"}
ok: [192.168.56.105] => (item=php5-memcache,memcached,apache2,php5,libapache2-mod-php5,php5-mcrypt) => {"changed": false, "item": "php5-memcache,memcached,apache2,php5,libapache2-mod-php5,php5-mcrypt"}
changed: [192.168.56.103] => (item=php5-memcache,memcached,apache2,php5,libapache2-mod-php5,php5-mcrypt) => {"changed": true, "item": "php5-memcache,memcached,apache2,php5,libapache2-mod-php5,php5-mcrypt", "stderr": "AH00557: apache2: apr_sockaddr_info_get() failed for memcached-3\nAH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1. Set the 'ServerName' directive globally to suppress this message\nhostname: Name or service not known\nmake-ssl-cert: Could not get FQDN, using \"memcached-3\".\nmake-ssl-cert: You may want to fix your /etc/hosts and/or DNS setup and run\nmake-ssl-cert: make-ssl-cert generate-default-snakeoil --force-overwrite\nmake-ssl-cert: again.\n\nCreating config file /etc/php5/mods-available/pdo.ini with new version\nphp5_invoke: Enable module pdo for apache2 SAPI\nphp5_invoke: Enable module pdo for cli SAPI\n\nCreating config file /etc/php5/mods-available/opcache.ini with new version\nphp5_invoke: Enable module opcache for apache2 SAPI\nphp5_invoke: Enable module opcache for cli SAPI\n\nCreating config file /etc/php5/cli/php.ini with new version\nphp5_invoke opcache: already enabled for cli SAPI\nphp5_invoke pdo: already enabled for cli SAPI\n\nCreating config file /etc/php5/mods-available/readline.ini with new version\nphp5_invoke: Enable module readline for apache2 SAPI\nphp5_invoke: Enable module readline for cli SAPI\nphp5_invoke: Enable module json for apache2 SAPI\nphp5_invoke: Enable module json for cli SAPI\n\nCreating config file /etc/php5/apache2/php.ini with new version\nphp5_invoke json: already enabled for apache2 SAPI\nphp5_invoke opcache: already enabled for apache2 SAPI\nphp5_invoke memcache: already enabled for apache2 SAPI\nphp5_invoke readline: already enabled for apache2 SAPI\nphp5_invoke pdo: already enabled for apache2 SAPI\napache2_switch_mpm Switch to prefork\nAH00557: apache2: apr_sockaddr_info_get() failed for memcached-3\nAH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1. Set the 'ServerName' directive globally to suppress this message\napache2_invoke: Enable module php5\nAH00557: apache2: apr_sockaddr_info_get() failed for memcached-3\nAH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1. Set the 'ServerName' directive globally to suppress this message\n", "stdout": "Reading package lists...\nBuilding dependency tree...\nReading state information...\nThe following extra packages will be installed:\n  apache2-bin apache2-data libapr1 libaprutil1 libaprutil1-dbd-sqlite3\n  libaprutil1-ldap libmcrypt4 php-pear php5-cli php5-common php5-json\n  php5-readline ssl-cert\nSuggested packages:\n  apache2-doc apache2-suexec-pristine apache2-suexec-custom apache2-utils\n  libmcrypt-dev mcrypt libcache-memcached-perl libmemcached php5-dev\n  php5-user-cache openssl-blacklist\nThe following NEW packages will be installed:\n  apache2 apache2-bin apache2-data libapache2-mod-php5 libapr1 libaprutil1\n  libaprutil1-dbd-sqlite3 libaprutil1-ldap libmcrypt4 memcached php-pear php5\n  php5-cli php5-common php5-json php5-mcrypt php5-memcache php5-readline\n  ssl-cert\n0 upgraded, 19 newly installed, 0 to remove and 210 not upgraded.\nNeed to get 6627 kB of archives.\nAfter this operation, 28.9 MB of additional disk space will be used.\nGet:1 http://us.archive.ubuntu.com/ubuntu/ trusty/main libapr1 amd64 1.5.0-1 [85.1 kB]\nGet:2 http://us.archive.ubuntu.com/ubuntu/ trusty/main libaprutil1 amd64 1.5.3-1 [76.4 kB]\nGet:3 http://us.archive.ubuntu.com/ubuntu/ trusty/main php5-json amd64 1.3.2-2build1 [34.4 kB]\nGet:4 http://us.archive.ubuntu.com/ubuntu/ trusty-updates/main php5-common amd64 5.5.9+dfsg-1ubuntu4.19 [446 kB]\nGet:5 http://us.archive.ubuntu.com/ubuntu/ trusty-updates/main php5-cli amd64 5.5.9+dfsg-1ubuntu4.19 [2164 kB]\nGet:6 http://us.archive.ubuntu.com/ubuntu/ trusty-updates/main php5-readline amd64 5.5.9+dfsg-1ubuntu4.19 [12.1 kB]\nGet:7 http://us.archive.ubuntu.com/ubuntu/ trusty/main libaprutil1-dbd-sqlite3 amd64 1.5.3-1 [10.5 kB]\nGet:8 http://us.archive.ubuntu.com/ubuntu/ trusty/main libaprutil1-ldap amd64 1.5.3-1 [8634 B]\nGet:9 http://us.archive.ubuntu.com/ubuntu/ trusty-updates/main apache2-bin amd64 2.4.7-1ubuntu4.13 [839 kB]\nGet:10 http://us.archive.ubuntu.com/ubuntu/ trusty-updates/main apache2-data all 2.4.7-1ubuntu4.13 [160 kB]\nGet:11 http://us.archive.ubuntu.com/ubuntu/ trusty-updates/main apache2 amd64 2.4.7-1ubuntu4.13 [87.4 kB]\nGet:12 http://us.archive.ubuntu.com/ubuntu/ trusty-updates/main libapache2-mod-php5 amd64 5.5.9+dfsg-1ubuntu4.19 [2207 kB]\nGet:13 http://us.archive.ubuntu.com/ubuntu/ trusty/universe libmcrypt4 amd64 2.5.8-3.1ubuntu1 [61.9 kB]\nGet:14 http://us.archive.ubuntu.com/ubuntu/ trusty/main memcached amd64 1.4.14-0ubuntu9 [66.7 kB]\nGet:15 http://us.archive.ubuntu.com/ubuntu/ trusty-updates/main php-pear all 5.5.9+dfsg-1ubuntu4.19 [267 kB]\nGet:16 http://us.archive.ubuntu.com/ubuntu/ trusty-updates/main php5 all 5.5.9+dfsg-1ubuntu4.19 [1308 B]\nGet:17 http://us.archive.ubuntu.com/ubuntu/ trusty/universe php5-mcrypt amd64 5.4.6-0ubuntu5 [15.4 kB]\nGet:18 http://us.archive.ubuntu.com/ubuntu/ trusty/universe php5-memcache amd64 3.0.8-4build1 [66.9 kB]\nGet:19 http://us.archive.ubuntu.com/ubuntu/ trusty/main ssl-cert all 1.0.33 [16.6 kB]\nPreconfiguring packages ...\nFetched 6627 kB in 1min 54s (57.7 kB/s)\nSelecting previously unselected package libapr1:amd64.\n(Reading database ... 55851 files and directories currently installed.)\nPreparing to unpack .../libapr1_1.5.0-1_amd64.deb ...\nUnpacking libapr1:amd64 (1.5.0-1) ...\nSelecting previously unselected package libaprutil1:amd64.\nPreparing to unpack .../libaprutil1_1.5.3-1_amd64.deb ...\nUnpacking libaprutil1:amd64 (1.5.3-1) ...\nSelecting previously unselected package php5-json.\nPreparing to unpack .../php5-json_1.3.2-2build1_amd64.deb ...\nUnpacking php5-json (1.3.2-2build1) ...\nSelecting previously unselected package php5-common.\nPreparing to unpack .../php5-common_5.5.9+dfsg-1ubuntu4.19_amd64.deb ...\nUnpacking php5-common (5.5.9+dfsg-1ubuntu4.19) ...\nSelecting previously unselected package php5-cli.\nPreparing to unpack .../php5-cli_5.5.9+dfsg-1ubuntu4.19_amd64.deb ...\nUnpacking php5-cli (5.5.9+dfsg-1ubuntu4.19) ...\nSelecting previously unselected package php5-readline.\nPreparing to unpack .../php5-readline_5.5.9+dfsg-1ubuntu4.19_amd64.deb ...\nUnpacking php5-readline (5.5.9+dfsg-1ubuntu4.19) ...\nSelecting previously unselected package libaprutil1-dbd-sqlite3:amd64.\nPreparing to unpack .../libaprutil1-dbd-sqlite3_1.5.3-1_amd64.deb ...\nUnpacking libaprutil1-dbd-sqlite3:amd64 (1.5.3-1) ...\nSelecting previously unselected package libaprutil1-ldap:amd64.\nPreparing to unpack .../libaprutil1-ldap_1.5.3-1_amd64.deb ...\nUnpacking libaprutil1-ldap:amd64 (1.5.3-1) ...\nSelecting previously unselected package apache2-bin.\nPreparing to unpack .../apache2-bin_2.4.7-1ubuntu4.13_amd64.deb ...\nUnpacking apache2-bin (2.4.7-1ubuntu4.13) ...\nSelecting previously unselected package apache2-data.\nPreparing to unpack .../apache2-data_2.4.7-1ubuntu4.13_all.deb ...\nUnpacking apache2-data (2.4.7-1ubuntu4.13) ...\nSelecting previously unselected package apache2.\nPreparing to unpack .../apache2_2.4.7-1ubuntu4.13_amd64.deb ...\nUnpacking apache2 (2.4.7-1ubuntu4.13) ...\nSelecting previously unselected package libapache2-mod-php5.\nPreparing to unpack .../libapache2-mod-php5_5.5.9+dfsg-1ubuntu4.19_amd64.deb ...\nUnpacking libapache2-mod-php5 (5.5.9+dfsg-1ubuntu4.19) ...\nSelecting previously unselected package libmcrypt4.\nPreparing to unpack .../libmcrypt4_2.5.8-3.1ubuntu1_amd64.deb ...\nUnpacking libmcrypt4 (2.5.8-3.1ubuntu1) ...\nSelecting previously unselected package memcached.\nPreparing to unpack .../memcached_1.4.14-0ubuntu9_amd64.deb ...\nUnpacking memcached (1.4.14-0ubuntu9) ...\nSelecting previously unselected package php-pear.\nPreparing to unpack .../php-pear_5.5.9+dfsg-1ubuntu4.19_all.deb ...\nUnpacking php-pear (5.5.9+dfsg-1ubuntu4.19) ...\nSelecting previously unselected package php5.\nPreparing to unpack .../php5_5.5.9+dfsg-1ubuntu4.19_all.deb ...\nUnpacking php5 (5.5.9+dfsg-1ubuntu4.19) ...\nSelecting previously unselected package php5-mcrypt.\nPreparing to unpack .../php5-mcrypt_5.4.6-0ubuntu5_amd64.deb ...\nUnpacking php5-mcrypt (5.4.6-0ubuntu5) ...\nSelecting previously unselected package php5-memcache.\nPreparing to unpack .../php5-memcache_3.0.8-4build1_amd64.deb ...\nUnpacking php5-memcache (3.0.8-4build1) ...\nSelecting previously unselected package ssl-cert.\nPreparing to unpack .../ssl-cert_1.0.33_all.deb ...\nUnpacking ssl-cert (1.0.33) ...\nProcessing triggers for man-db (2.6.7.1-1) ...\nProcessing triggers for ureadahead (0.100.0-16) ...\nureadahead will be reprofiled on next reboot\nProcessing triggers for ufw (0.34~rc-0ubuntu2) ...\nSetting up libapr1:amd64 (1.5.0-1) ...\nSetting up libaprutil1:amd64 (1.5.3-1) ...\nSetting up libaprutil1-dbd-sqlite3:amd64 (1.5.3-1) ...\nSetting up libaprutil1-ldap:amd64 (1.5.3-1) ...\nSetting up apache2-bin (2.4.7-1ubuntu4.13) ...\nSetting up apache2-data (2.4.7-1ubuntu4.13) ...\nSetting up apache2 (2.4.7-1ubuntu4.13) ...\nEnabling module mpm_event.\nEnabling module authz_core.\nEnabling module authz_host.\nEnabling module authn_core.\nEnabling module auth_basic.\nEnabling module access_compat.\nEnabling module authn_file.\nEnabling module authz_user.\nEnabling module alias.\nEnabling module dir.\nEnabling module autoindex.\nEnabling module env.\nEnabling module mime.\nEnabling module negotiation.\nEnabling module setenvif.\nEnabling module filter.\nEnabling module deflate.\nEnabling module status.\nEnabling conf charset.\nEnabling conf localized-error-pages.\nEnabling conf other-vhosts-access-log.\nEnabling conf security.\nEnabling conf serve-cgi-bin.\nEnabling site 000-default.\n * Starting web server apache2\n * \nSetting up libmcrypt4 (2.5.8-3.1ubuntu1) ...\nSetting up memcached (1.4.14-0ubuntu9) ...\nStarting memcached: memcached.\nSetting up ssl-cert (1.0.33) ...\nSetting up php5-common (5.5.9+dfsg-1ubuntu4.19) ...\nSetting up php5-cli (5.5.9+dfsg-1ubuntu4.19) ...\nupdate-alternatives: using /usr/bin/php5 to provide /usr/bin/php (php) in auto mode\nSetting up php5-readline (5.5.9+dfsg-1ubuntu4.19) ...\nSetting up php-pear (5.5.9+dfsg-1ubuntu4.19) ...\nSetting up php5-mcrypt (5.4.6-0ubuntu5) ...\nSetting up php5-memcache (3.0.8-4build1) ...\nSetting up php5-json (1.3.2-2build1) ...\nProcessing triggers for ureadahead (0.100.0-16) ...\nProcessing triggers for ufw (0.34~rc-0ubuntu2) ...\nSetting up libapache2-mod-php5 (5.5.9+dfsg-1ubuntu4.19) ...\nModule mpm_event disabled.\nEnabling module mpm_prefork.\n * Restarting web server apache2\n   ...done.\n * Restarting web server apache2\n   ...done.\nSetting up php5 (5.5.9+dfsg-1ubuntu4.19) ...\nProcessing triggers for libc-bin (2.19-0ubuntu6) ...\n"}

TASK: [copy session.php file in document root] ********************************
changed: [192.168.56.103] => {"changed": true, "dest": "/var/www/html/session.php", "gid": 0, "group": "root", "md5sum": "53a6884f23dc846923abff6f991ce4e8", "mode": "0644", "owner": "root", "size": 458, "src": "/root/.ansible/tmp/ansible-tmp-1472672605.45-182510254008554/source", "state": "file", "uid": 0}
ok: [192.168.56.104] => {"changed": false, "dest": "/var/www/html/session.php", "gid": 0, "group": "root", "md5sum": "53a6884f23dc846923abff6f991ce4e8", "mode": "0644", "owner": "root", "path": "/var/www/html/session.php", "size": 458, "state": "file", "uid": 0}
ok: [192.168.56.105] => {"changed": false, "dest": "/var/www/html/session.php", "gid": 0, "group": "root", "md5sum": "53a6884f23dc846923abff6f991ce4e8", "mode": "0644", "owner": "root", "path": "/var/www/html/session.php", "size": 458, "state": "file", "uid": 0}

TASK: [update php.ini file in server] *****************************************
ok: [192.168.56.104] => {"changed": false, "dest": "/etc/php5/apache2/php.ini", "gid": 0, "group": "root", "md5sum": "bdde077e4d3ba3f0730cbfa92943a639", "mode": "0644", "owner": "root", "path": "/etc/php5/apache2/php.ini", "size": 70009, "state": "file", "uid": 0}
ok: [192.168.56.105] => {"changed": false, "dest": "/etc/php5/apache2/php.ini", "gid": 0, "group": "root", "md5sum": "bdde077e4d3ba3f0730cbfa92943a639", "mode": "0644", "owner": "root", "path": "/etc/php5/apache2/php.ini", "size": 70009, "state": "file", "uid": 0}
changed: [192.168.56.103] => {"changed": true, "dest": "/etc/php5/apache2/php.ini", "gid": 0, "group": "root", "md5sum": "bdde077e4d3ba3f0730cbfa92943a639", "mode": "0644", "owner": "root", "size": 70009, "src": "/root/.ansible/tmp/ansible-tmp-1472672612.58-185634532596800/source", "state": "file", "uid": 0}

TASK: [update memcached.ini file in servers] **********************************
ok: [192.168.56.104] => {"changed": false, "dest": "/etc/php5/mods-available/memcached.ini", "gid": 0, "group": "root", "md5sum": "80afdaccdaa9d159b7995afa8d408e78", "mode": "0644", "owner": "root", "path": "/etc/php5/mods-available/memcached.ini", "size": 126, "state": "file", "uid": 0}
ok: [192.168.56.105] => {"changed": false, "dest": "/etc/php5/mods-available/memcached.ini", "gid": 0, "group": "root", "md5sum": "80afdaccdaa9d159b7995afa8d408e78", "mode": "0644", "owner": "root", "path": "/etc/php5/mods-available/memcached.ini", "size": 126, "state": "file", "uid": 0}
changed: [192.168.56.103] => {"changed": true, "dest": "/etc/php5/mods-available/memcached.ini", "gid": 0, "group": "root", "md5sum": "80afdaccdaa9d159b7995afa8d408e78", "mode": "0644", "owner": "root", "size": 126, "src": "/root/.ansible/tmp/ansible-tmp-1472672613.29-122556613223545/source", "state": "file", "uid": 0}

TASK: [Memcached Config file] *************************************************
ok: [192.168.56.104] => {"changed": false, "gid": 0, "group": "root", "mode": "0644", "owner": "root", "path": "/etc/memcached.conf", "size": 1429, "state": "file", "uid": 0}
ok: [192.168.56.105] => {"changed": false, "gid": 0, "group": "root", "mode": "0644", "owner": "root", "path": "/etc/memcached.conf", "size": 1429, "state": "file", "uid": 0}
changed: [192.168.56.103] => {"changed": true, "dest": "/etc/memcached.conf", "gid": 0, "group": "root", "md5sum": "7430c25c9e8b4b0c41f79ceb9589b88d", "mode": "0644", "owner": "root", "size": 1429, "src": "/root/.ansible/tmp/ansible-tmp-1472672613.78-219507305685997/source", "state": "file", "uid": 0}

TASK: [start consul server] ***************************************************
<192.168.56.104> REMOTE_MODULE command service apache2 restart
<192.168.56.105> REMOTE_MODULE command service apache2 restart
<192.168.56.103> REMOTE_MODULE command service apache2 restart
changed: [192.168.56.104] => {"changed": true, "cmd": ["service", "apache2", "restart"], "delta": "0:00:02.549360", "end": "2016-09-01 02:36:20.360791", "rc": 0, "start": "2016-09-01 02:36:17.811431", "stderr": "AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 192.168.56.104. Set the 'ServerName' directive globally to suppress this message", "stdout": " * Restarting web server apache2\n   ...done."}
changed: [192.168.56.103] => {"changed": true, "cmd": ["service", "apache2", "restart"], "delta": "0:00:02.797869", "end": "2016-09-01 07:03:27.838203", "rc": 0, "start": "2016-09-01 07:03:25.040334", "stderr": "AH00557: apache2: apr_sockaddr_info_get() failed for memcached-3\nAH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1. Set the 'ServerName' directive globally to suppress this message", "stdout": " * Restarting web server apache2\n   ...done."}
changed: [192.168.56.105] => {"changed": true, "cmd": ["service", "apache2", "restart"], "delta": "0:00:03.203582", "end": "2016-09-01 07:03:31.302176", "rc": 0, "start": "2016-09-01 07:03:28.098594", "stderr": "AH00557: apache2: apr_sockaddr_info_get() failed for memcached-2\nAH00558: apache2: Could not reliably determine the server's fully qualified domain name, using 127.0.0.1. Set the 'ServerName' directive globally to suppress this message", "stdout": " * Restarting web server apache2\n   ...done."}

PLAY RECAP ********************************************************************
192.168.56.103             : ok=7    changed=6    unreachable=0    failed=0
192.168.56.104             : ok=7    changed=1    unreachable=0    failed=0
192.168.56.105             : ok=7    changed=1    unreachable=0    failed=0

